"use strict";(self["webpackChunkwebrtc_vue"]=self["webpackChunkwebrtc_vue"]||[]).push([[854],{5082:function(t,e,i){i(7658),Object.defineProperty(e,"__esModule",{value:!0}),e.Transport=void 0;const a=i(6645),s="ion-sfu",n="no active session, join first";var o;(function(t){t[t["pub"]=0]="pub",t[t["sub"]=1]="sub"})(o||(o={}));class r{constructor(t,e,i){this.signal=e,this.pc=new RTCPeerConnection(i),this.candidates=[],t===o.pub&&this.pc.createDataChannel(s),this.pc.onicecandidate=({candidate:e})=>{e&&this.signal.trickle({target:t,candidate:e})},this.pc.oniceconnectionstatechange=async t=>{"disconnected"===this.pc.iceConnectionState&&void 0!==this.pc.restartIce&&this.pc.restartIce()}}}e.Transport=r;class c{constructor(t,e={codec:"vp8",iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]}]}){this.signal=t,this.config=e,t.onnegotiate=this.negotiate.bind(this),t.ontrickle=this.trickle.bind(this)}async join(t,e){this.transports={[o.pub]:new r(o.pub,this.signal,this.config),[o.sub]:new r(o.sub,this.signal,this.config)},this.transports[o.sub].pc.ontrack=t=>{const e=t.streams[0],i=a.makeRemote(e,this.transports[o.sub]);this.ontrack&&this.ontrack(t.track,i)};const i=new Promise((t=>{this.transports[o.sub].pc.ondatachannel=e=>{if(e.channel.label===s)return this.transports[o.sub].api=e.channel,this.transports[o.pub].api=e.channel,e.channel.onmessage=t=>{try{const e=JSON.parse(t.data);this.processChannelMessage(e)}catch(e){console.error(e)}},void t();this.ondatachannel&&this.ondatachannel(e)}})),n=await this.transports[o.pub].pc.createOffer();await this.transports[o.pub].pc.setLocalDescription(n);const c=await this.signal.join(t,e,n);return await this.transports[o.pub].pc.setRemoteDescription(c),this.transports[o.pub].candidates.forEach((t=>this.transports[o.pub].pc.addIceCandidate(t))),this.transports[o.pub].pc.onnegotiationneeded=this.onNegotiationNeeded.bind(this),i}leave(){this.transports&&(Object.values(this.transports).forEach((t=>t.pc.close())),delete this.transports)}getPubStats(t){if(!this.transports)throw Error(n);return this.transports[o.pub].pc.getStats(t)}getSubStats(t){if(!this.transports)throw Error(n);return this.transports[o.sub].pc.getStats(t)}publish(t,e){if(!this.transports)throw Error(n);t.publish(this.transports[o.pub],e)}restartIce(){this.renegotiate(!0)}createDataChannel(t){if(!this.transports)throw Error(n);return this.transports[o.pub].pc.createDataChannel(t)}close(){this.transports&&Object.values(this.transports).forEach((t=>t.pc.close())),this.signal.close()}trickle({candidate:t,target:e}){if(!this.transports)throw Error(n);this.transports[e].pc.remoteDescription?this.transports[e].pc.addIceCandidate(t):this.transports[e].candidates.push(t)}async negotiate(t){if(!this.transports)throw Error(n);let e;try{await this.transports[o.sub].pc.setRemoteDescription(t),this.transports[o.sub].candidates.forEach((t=>this.transports[o.sub].pc.addIceCandidate(t))),this.transports[o.sub].candidates=[],e=await this.transports[o.sub].pc.createAnswer(),await this.transports[o.sub].pc.setLocalDescription(e),this.signal.answer(e)}catch(i){console.error(i),this.onerrnegotiate&&this.onerrnegotiate(o.sub,i,t,e)}}onNegotiationNeeded(){this.renegotiate(!1)}async renegotiate(t){if(!this.transports)throw Error(n);let e,i;try{e=await this.transports[o.pub].pc.createOffer({iceRestart:t}),await this.transports[o.pub].pc.setLocalDescription(e),i=await this.signal.offer(e),await this.transports[o.pub].pc.setRemoteDescription(i)}catch(a){console.error(a),this.onerrnegotiate&&this.onerrnegotiate(o.pub,a,e,i)}}processChannelMessage(t){if(void 0!==t.method&&void 0!==t.params)switch(t.method){case"audioLevels":this.onspeaker&&this.onspeaker(t.params);break;case"activeLayer":this.onactivelayer&&this.onactivelayer(t.params);break;default:}else this.onspeaker&&this.onspeaker(t)}}e["default"]=c},2630:function(t,e,i){e.WH=e.KU=void 0;const a=i(5082);e.KU=a.default;const s=i(6645);Object.defineProperty(e,"WH",{enumerable:!0,get:function(){return s.LocalStream}})},6645:function(t,e,i){i(7658),Object.defineProperty(e,"__esModule",{value:!0}),e.makeRemote=e.LocalStream=e.VideoConstraints=void 0;const a=["qvga","vga","shd","hd","fhd","qhd"];e.VideoConstraints={qvga:{resolution:{width:{ideal:320},height:{ideal:180},frameRate:{ideal:15,max:30}},encodings:{maxBitrate:15e4,maxFramerate:15}},vga:{resolution:{width:{ideal:640},height:{ideal:360},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:5e5,maxFramerate:30}},shd:{resolution:{width:{ideal:960},height:{ideal:540},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:12e5,maxFramerate:30}},hd:{resolution:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:25e5,maxFramerate:30}},fhd:{resolution:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:4e6,maxFramerate:30}},qhd:{resolution:{width:{ideal:2560},height:{ideal:1440},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:8e6,maxFramerate:30}}};const s={resolution:"hd",codec:"vp8",audio:!0,video:!0,simulcast:!1};class n extends MediaStream{constructor(t,e){super(t),this.constraints=e}static async getUserMedia(t=s){const e=await navigator.mediaDevices.getUserMedia({audio:n.computeAudioConstraints({...s,...t}),video:n.computeVideoConstraints({...s,...t})});return new n(e,{...s,...t})}static async getDisplayMedia(t={codec:"vp8",resolution:"hd",audio:!1,video:!0,simulcast:!1}){const e=await navigator.mediaDevices.getDisplayMedia(t);return new n(e,{...s,...t})}static computeAudioConstraints(t){return t.audio}static computeVideoConstraints(t){return t.video instanceof Object?t.video:t.video&&t.resolution?{...e.VideoConstraints[t.resolution].resolution}:t.video}getTrack(t){let e;return"video"===t?(e=this.getVideoTracks(),e.length>0?this.getVideoTracks()[0]:void 0):(e=this.getAudioTracks(),e.length>0?this.getAudioTracks()[0]:void 0)}async getNewTrack(t){const e=await navigator.mediaDevices.getUserMedia({[t]:"video"===t?n.computeVideoConstraints(this.constraints):n.computeAudioConstraints(this.constraints)});return e.getTracks()[0]}publishTrack(t){if(this.pc){const i={streams:[this],direction:"sendonly"};if("video"===t.kind)if(this.encodingParams)i.sendEncodings=this.encodingParams;else if(this.constraints.simulcast){const t=a.indexOf(this.constraints.resolution),s=[{rid:"f",maxBitrate:e.VideoConstraints[a[t]].encodings.maxBitrate,maxFramerate:e.VideoConstraints[a[t]].encodings.maxFramerate}];t-1>=0&&s.push({rid:"h",scaleResolutionDownBy:2,maxBitrate:e.VideoConstraints[a[t-1]].encodings.maxBitrate,maxFramerate:e.VideoConstraints[a[t-1]].encodings.maxFramerate}),t-2>=0&&s.push({rid:"q",scaleResolutionDownBy:4,maxBitrate:e.VideoConstraints[a[t-2]].encodings.maxBitrate,maxFramerate:e.VideoConstraints[a[t-2]].encodings.maxFramerate}),i.sendEncodings=s}else i.sendEncodings=[e.VideoConstraints[this.constraints.resolution].encodings];const s=this.pc.addTransceiver(t,i);this.setPreferredCodec(s,t.kind)}}setPreferredCodec(t,e){if("setCodecPreferences"in t){const i=RTCRtpSender.getCapabilities(e);if(!i)return;let a;if(this.constraints.preferredCodecProfile&&"video"===e){const t=i.codecs.filter((t=>t.mimeType.toLowerCase()===`video/${this.constraints.codec.toLowerCase()}`));if(!t)return;a=t.find((t=>{var e;return t.sdpFmtpLine&&(null===(e=t.sdpFmtpLine)||void 0===e?void 0:e.indexOf(`profile-level-id=${this.constraints.preferredCodecProfile}`))>=0})),a||(a=t[0])}else a=i.codecs.find((t=>t.mimeType.toLowerCase()===`video/${this.constraints.codec.toLowerCase()}`||"audio/opus"===t.mimeType.toLowerCase()));a&&t.setCodecPreferences([a])}}updateTrack(t,e){this.addTrack(t),e?(this.removeTrack(e),e.stop(),this.pc&&this.pc.getSenders().forEach((async e=>{var i,a;(null===(i=null===e||void 0===e?void 0:e.track)||void 0===i?void 0:i.kind)===t.kind&&(null===(a=e.track)||void 0===a||a.stop(),e.replaceTrack(t))}))):this.pc&&this.publishTrack(t)}initAudioEmptyTrack(){const t=window.AudioContext||window.webkitAudioContext,e=new t,i=e.createOscillator();i.frequency.setValueAtTime(2e4,e.currentTime);const a=i.connect(e.createMediaStreamDestination());return i.start(),a.stream.getAudioTracks()[0]}initVideoEmptyTrack(t,e){var i;const a=Object.assign(document.createElement("canvas"),{width:t,height:e});null===(i=a.getContext("2d"))||void 0===i||i.fillRect(0,0,t,e);const s=a.captureStream();return s.getVideoTracks()[0]}publish(t,e){this.pc=t.pc,this.api=t.api,this.encodingParams=e,this.getTracks().forEach(this.publishTrack.bind(this))}unpublish(){if(this.pc){const t=this.getTracks();this.pc.getSenders().forEach((e=>{e.track&&t.includes(e.track)&&this.pc.removeTrack(e)}))}}async switchDevice(t,e){this.constraints={...this.constraints,[t]:this.constraints[t]instanceof Object?{...this.constraints[t],deviceId:e}:{deviceId:e}};const i=this.getTrack(t);i&&i.stop();const a=await this.getNewTrack(t);this.updateTrack(a,i)}mute(t){const e=this.getTrack(t);if(e&&this.constraints.sendEmptyOnMute){const i="audio"===t?this.initAudioEmptyTrack():this.initVideoEmptyTrack((null===e||void 0===e?void 0:e.getSettings().width)||640,(null===e||void 0===e?void 0:e.getSettings().height)||360);return i.enabled=!1,void this.updateTrack(i,e)}e&&e.stop()}async unmute(t){const e=this.getTrack(t),i=await this.getNewTrack(t);this.updateTrack(i,e)}async enableLayers(t){const e={streamId:this.id,layers:t};JSON.stringify(e);this.api&&("open"!==this.api.readyState?this.api.onopen=()=>{var t;return null===(t=this.api)||void 0===t?void 0:t.send(JSON.stringify(e))}:this.api.send(JSON.stringify(e)));const i=["high","medium","low"];await Promise.all(i.map((async e=>{await this.updateMediaEncodingParams({active:t.includes(e)},e)})))}async updateMediaEncodingParams(t,e){var i;if(!this.pc)return;const a=this.getTracks();await Promise.all(null===(i=this.pc)||void 0===i?void 0:i.getSenders().filter((t=>t.track&&a.includes(t.track))).map((async i=>{const a=i.getParameters();a.encodings||(a.encodings=[{}]);let s=0;if(this.constraints.simulcast&&e){const t="high"===e?"f":"medium"===e?"h":"q";if(s=a.encodings.findIndex((e=>e.rid===t)),a.encodings.length<s+1)return}a.encodings[s]={...a.encodings[s],...t},await i.setParameters(a)})))}}function o(t,e){const i=t;i.audio=!0,i.video="none",i.framerate="high",i._videoPreMute="high";const a=()=>{const t={streamId:i.id,video:i.video,audio:i.audio,framerate:i.framerate};e.api&&("open"!==e.api.readyState?e.api.onopen=()=>{var i;return null===(i=e.api)||void 0===i?void 0:i.send(JSON.stringify(t))}:e.api.send(JSON.stringify(t)))};return i.preferLayer=t=>{i.video=t,a()},i.preferFramerate=t=>{i.framerate=t,a()},i.mute=t=>{"audio"===t?i.audio=!1:"video"===t&&(i._videoPreMute=i.video,i.video="none"),a()},i.unmute=t=>{"audio"===t?i.audio=!0:"video"===t&&(i.video=i._videoPreMute),a()},i}e.LocalStream=n,e.makeRemote=o},2854:function(t,e,i){i.r(e),i.d(e,{default:function(){return U}});var a=i(3396),s=i(9242);const n=t=>((0,a.dD)("data-v-061323da"),t=t(),(0,a.Cn)(),t),o={class:"container"},r={class:"video-container"},c={class:"videoWrapper"},d={class:"videoInfo"},l=["src"],u=["src"],h=["srcObject"],m={class:"form-container"},p=n((()=>(0,a._)("h2",null,"Enter Meeting Room",-1))),g=n((()=>(0,a._)("label",{for:"roomName"},"Room Name:",-1))),v=n((()=>(0,a._)("label",{for:"username"},"Username:",-1))),f=n((()=>(0,a._)("label",null,"Camera:",-1))),b=n((()=>(0,a._)("option",{value:"false"},"On",-1))),w=n((()=>(0,a._)("option",{value:"true"},"Off",-1))),C=[b,w],k=n((()=>(0,a._)("label",null,"Microphone:",-1))),S=n((()=>(0,a._)("option",{value:"false"},"On",-1))),y=n((()=>(0,a._)("option",{value:"true"},"Off",-1))),M=[S,y],_=n((()=>(0,a._)("label",null,"resolution:",-1))),x=(0,a.uE)('<option value="qvga" data-v-061323da>qvga</option><option value="vga" data-v-061323da>vga</option><option value="shd" data-v-061323da>shd</option><option value="hd" data-v-061323da>hd</option><option value="fhd" data-v-061323da>fhd</option><option value="qhd" data-v-061323da>qhd</option>',6),T=[x],V=n((()=>(0,a._)("label",null,"Mute Newcomers:",-1))),P=n((()=>(0,a._)("option",{value:"false"},"Yes",-1))),E=n((()=>(0,a._)("option",{value:"true"},"No",-1))),R=[P,E],L=n((()=>(0,a._)("label",null,"PublishStream:",-1))),N=n((()=>(0,a._)("option",{value:"true"},"Yes",-1))),O=n((()=>(0,a._)("option",{value:"false"},"No",-1))),D=[N,O],I=n((()=>(0,a._)("button",{type:"submit"},"Join Meeting",-1)));function A(t,e,n,b,w,S){return(0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",r,[(0,a._)("div",c,[(0,a._)("div",d,[(0,a._)("img",{src:"true"===w.initAudioMute?i(503):i(927),alt:""},null,8,l),(0,a._)("img",{src:"true"===w.initVideoMute?i(1291):i(880),alt:""},null,8,u)]),(0,a._)("video",{srcObject:w.initLocalStream,controls:"",autoplay:"",class:"video"},null,8,h)])]),(0,a._)("div",m,[p,(0,a._)("form",{onSubmit:e[11]||(e[11]=(0,s.iM)(((...t)=>S.joinMeeting&&S.joinMeeting(...t)),["prevent"]))},[(0,a._)("div",null,[g,(0,a.wy)((0,a._)("input",{type:"text",id:"roomName","onUpdate:modelValue":e[0]||(e[0]=t=>w.roomName=t),maxlength:30,required:""},null,512),[[s.nr,w.roomName]])]),(0,a._)("div",null,[v,(0,a.wy)((0,a._)("input",{type:"text",id:"username","onUpdate:modelValue":e[1]||(e[1]=t=>w.username=t),maxlength:20,required:""},null,512),[[s.nr,w.username]])]),(0,a._)("div",null,[f,(0,a.wy)((0,a._)("select",{id:"camera","onUpdate:modelValue":e[2]||(e[2]=t=>w.initVideoMute=t),onChange:e[3]||(e[3]=(...t)=>S.onCameraChange&&S.onCameraChange(...t))},C,544),[[s.bM,w.initVideoMute]])]),(0,a._)("div",null,[k,(0,a.wy)((0,a._)("select",{id:"microphone","onUpdate:modelValue":e[4]||(e[4]=t=>w.initAudioMute=t),onChange:e[5]||(e[5]=(...t)=>S.onMicChange&&S.onMicChange(...t))},M,544),[[s.bM,w.initAudioMute]])]),(0,a._)("div",null,[_,(0,a.wy)((0,a._)("select",{id:"resolution","onUpdate:modelValue":e[6]||(e[6]=t=>w.resolution=t),onChange:e[7]||(e[7]=(...t)=>S.onResolutionChange&&S.onResolutionChange(...t))},T,544),[[s.bM,w.resolution]])]),(0,a._)("div",null,[V,(0,a.wy)((0,a._)("select",{id:"muteNewcomers","onUpdate:modelValue":e[8]||(e[8]=t=>w.initRemoteStreamMute=t)},R,512),[[s.bM,w.initRemoteStreamMute]])]),(0,a._)("div",null,[L,(0,a.wy)((0,a._)("select",{id:"muteNewcomers","onUpdate:modelValue":e[9]||(e[9]=t=>w.initPublishStream=t),onChange:e[10]||(e[10]=(...t)=>S.onCPublishStreamChange&&S.onCPublishStreamChange(...t))},D,544),[[s.bM,w.initPublishStream]])]),I],32)])])}i(7658);var j=i(2630),q={name:"indexVue",data(){return{roomName:"",username:"",resolution:"qvga",initVideoMute:"false",initAudioMute:"false",initRemoteStreamMute:"true",initPublishStream:"true",initLocalStream:null}},methods:{onResolutionChange(){this.init()},onCPublishStreamChange(){if(console.log("Camera changed: "+this.initPublishStream),"true"===this.initPublishStream)this.init();else if(null!==this.initLocalStream){let t=this.initLocalStream.getTracks();t.forEach((t=>{t.stop()})),this.initLocalStream=null}},onCameraChange(){if(console.log("Camera changed: "+this.initVideoMute),null!=this.initLocalStream){let t=this.initLocalStream.getVideoTracks();0!==t.length&&("true"===this.initVideoMute?(console.log("1"),t[0].enabled=!1):(console.log("2"),console.log(this.initVideoMute),t[0].enabled=!0))}},onMicChange(){if(console.log("Camera changed: "+this.initVideoMute),null!=this.initLocalStream){let t=this.initLocalStream.getAudioTracks();0!==t.length&&(this.initVideoMute?t[0].enabled=!1:t[0].enabled=!0)}},async init(){await j.WH.getUserMedia({resolution:this.resolution,audio:!0,codec:"vp8"}).then((t=>{console.log(t),this.initLocalStream=t})).catch((t=>{console.error(t)}))},joinMeeting(){this.roomName.trim()&&this.username.trim()?this.roomName.trim().length>30||this.username.trim().length>20?alert("Please enter a value within the maximum length."):(sessionStorage.setItem("username",this.username.trim()),sessionStorage.setItem("audioMute",this.initAudioMute),sessionStorage.setItem("videoMute",this.initVideoMute),sessionStorage.setItem("remoteStreamMute",this.initRemoteStreamMute),sessionStorage.setItem("publishStream",this.initPublishStream),sessionStorage.setItem("resolution",this.resolution),this.$router.push("/meeting/"+this.roomName.trim())):alert("Please fill in all required fields.")}},mounted(){this.init()},watch(){}},F=i(89);const B=(0,F.Z)(q,[["render",A],["__scopeId","data-v-061323da"]]);var U=B},927:function(t,e,i){t.exports=i.p+"img/mic-green.93d097ec.svg"},503:function(t,e,i){t.exports=i.p+"img/mic-off-red.25878cb2.svg"},880:function(t,e,i){t.exports=i.p+"img/video-green.343b1027.svg"},1291:function(t,e,i){t.exports=i.p+"img/video-off-red.657523d9.svg"}}]);
//# sourceMappingURL=854.e82a3759.js.map