(self["webpackChunkwebrtc_vue"]=self["webpackChunkwebrtc_vue"]||[]).push([[582],{6077:function(t,e,s){var i=s(614),n=String,r=TypeError;t.exports=function(t){if("object"==typeof t||i(t))return t;throw r("Can't set "+n(t)+" as a prototype")}},3013:function(t){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(t,e,s){"use strict";var i,n,r,o=s(3013),a=s(9781),c=s(7854),h=s(614),u=s(111),l=s(2597),d=s(648),p=s(6330),f=s(8880),g=s(8052),m=s(7045),y=s(7976),v=s(9518),b=s(7674),k=s(5112),w=s(9711),T=s(9909),_=T.enforce,S=T.get,x=c.Int8Array,C=x&&x.prototype,A=c.Uint8ClampedArray,I=A&&A.prototype,L=x&&v(x),E=C&&v(C),R=Object.prototype,O=c.TypeError,P=k("toStringTag"),B=w("TYPED_ARRAY_TAG"),M="TypedArrayConstructor",N=o&&!!b&&"Opera"!==d(c.opera),D=!1,j={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},q={BigInt64Array:8,BigUint64Array:8},U=function(t){if(!u(t))return!1;var e=d(t);return"DataView"===e||l(j,e)||l(q,e)},V=function(t){var e=v(t);if(u(e)){var s=S(e);return s&&l(s,M)?s[M]:V(e)}},$=function(t){if(!u(t))return!1;var e=d(t);return l(j,e)||l(q,e)},G=function(t){if($(t))return t;throw O("Target is not a typed array")},F=function(t){if(h(t)&&(!b||y(L,t)))return t;throw O(p(t)+" is not a typed array constructor")},H=function(t,e,s,i){if(a){if(s)for(var n in j){var r=c[n];if(r&&l(r.prototype,t))try{delete r.prototype[t]}catch(o){try{r.prototype[t]=e}catch(h){}}}E[t]&&!s||g(E,t,s?e:N&&C[t]||e,i)}},z=function(t,e,s){var i,n;if(a){if(b){if(s)for(i in j)if(n=c[i],n&&l(n,t))try{delete n[t]}catch(r){}if(L[t]&&!s)return;try{return g(L,t,s?e:N&&L[t]||e)}catch(r){}}for(i in j)n=c[i],!n||n[t]&&!s||g(n,t,e)}};for(i in j)n=c[i],r=n&&n.prototype,r?_(r)[M]=n:N=!1;for(i in q)n=c[i],r=n&&n.prototype,r&&(_(r)[M]=n);if((!N||!h(L)||L===Function.prototype)&&(L=function(){throw O("Incorrect invocation")},N))for(i in j)c[i]&&b(c[i],L);if((!N||!E||E===R)&&(E=L.prototype,N))for(i in j)c[i]&&b(c[i].prototype,E);if(N&&v(I)!==E&&b(I,E),a&&!l(E,P))for(i in D=!0,m(E,P,{configurable:!0,get:function(){return u(this)?this[B]:void 0}}),j)c[i]&&f(c[i],B,i);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:N,TYPED_ARRAY_TAG:D&&B,aTypedArray:G,aTypedArrayConstructor:F,exportTypedArrayMethod:H,exportTypedArrayStaticMethod:z,getTypedArrayConstructor:V,isView:U,isTypedArray:$,TypedArray:L,TypedArrayPrototype:E}},7745:function(t,e,s){var i=s(6244);t.exports=function(t,e){var s=0,n=i(e),r=new t(n);while(n>s)r[s]=e[s++];return r}},1843:function(t,e,s){var i=s(6244);t.exports=function(t,e){for(var s=i(t),n=new e(s),r=0;r<s;r++)n[r]=t[s-r-1];return n}},1572:function(t,e,s){var i=s(6244),n=s(9303),r=RangeError;t.exports=function(t,e,s,o){var a=i(t),c=n(s),h=c<0?a+c:c;if(h>=a||h<0)throw r("Incorrect index");for(var u=new e(a),l=0;l<a;l++)u[l]=l===h?o:t[l];return u}},648:function(t,e,s){var i=s(1694),n=s(614),r=s(4326),o=s(5112),a=o("toStringTag"),c=Object,h="Arguments"==r(function(){return arguments}()),u=function(t,e){try{return t[e]}catch(s){}};t.exports=i?r:function(t){var e,s,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(s=u(e=c(t),a))?s:h?r(e):"Object"==(i=r(e))&&n(e.callee)?"Arguments":i}},8544:function(t,e,s){var i=s(7293);t.exports=!i((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},7045:function(t,e,s){var i=s(6339),n=s(3070);t.exports=function(t,e,s){return s.get&&i(s.get,e,{getter:!0}),s.set&&i(s.set,e,{setter:!0}),n.f(t,e,s)}},5668:function(t,e,s){var i=s(1702),n=s(9662);t.exports=function(t,e,s){try{return i(n(Object.getOwnPropertyDescriptor(t,e)[s]))}catch(r){}}},4067:function(t,e,s){var i=s(648);t.exports=function(t){var e=i(t);return"BigInt64Array"==e||"BigUint64Array"==e}},9518:function(t,e,s){var i=s(2597),n=s(614),r=s(7908),o=s(6200),a=s(8544),c=o("IE_PROTO"),h=Object,u=h.prototype;t.exports=a?h.getPrototypeOf:function(t){var e=r(t);if(i(e,c))return e[c];var s=e.constructor;return n(s)&&e instanceof s?s.prototype:e instanceof h?u:null}},7674:function(t,e,s){var i=s(5668),n=s(9670),r=s(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,s={};try{t=i(Object.prototype,"__proto__","set"),t(s,[]),e=s instanceof Array}catch(o){}return function(s,i){return n(s),r(i),e?t(s,i):s.__proto__=i,s}}():void 0)},7066:function(t,e,s){"use strict";var i=s(9670);t.exports=function(){var t=i(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},4599:function(t,e,s){var i=s(7593),n=TypeError;t.exports=function(t){var e=i(t,"number");if("number"==typeof e)throw n("Can't convert number to bigint");return BigInt(e)}},1694:function(t,e,s){var i=s(5112),n=i("toStringTag"),r={};r[n]="z",t.exports="[object z]"===String(r)},2087:function(t,e,s){var i=s(7854),n=s(9781),r=s(7045),o=s(7066),a=s(7293),c=i.RegExp,h=c.prototype,u=n&&a((function(){var t=!0;try{c(".","d")}catch(u){t=!1}var e={},s="",i=t?"dgimsy":"gimsy",n=function(t,i){Object.defineProperty(e,t,{get:function(){return s+=i,!0}})},r={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in t&&(r.hasIndices="d"),r)n(o,r[o]);var a=Object.getOwnPropertyDescriptor(h,"flags").get.call(e);return a!==i||s!==i}));u&&r(h,"flags",{configurable:!0,get:o})},1439:function(t,e,s){"use strict";var i=s(1843),n=s(260),r=n.aTypedArray,o=n.exportTypedArrayMethod,a=n.getTypedArrayConstructor;o("toReversed",(function(){return i(r(this),a(this))}))},7585:function(t,e,s){"use strict";var i=s(260),n=s(1702),r=s(9662),o=s(7745),a=i.aTypedArray,c=i.getTypedArrayConstructor,h=i.exportTypedArrayMethod,u=n(i.TypedArrayPrototype.sort);h("toSorted",(function(t){void 0!==t&&r(t);var e=a(this),s=o(c(e),e);return u(s,t)}))},5315:function(t,e,s){"use strict";var i=s(1572),n=s(260),r=s(4067),o=s(9303),a=s(4599),c=n.aTypedArray,h=n.getTypedArrayConstructor,u=n.exportTypedArrayMethod,l=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();u("with",{with:function(t,e){var s=c(this),n=o(t),u=r(s)?a(e):+e;return i(s,h(s),n,u)}}["with"],!l)},3767:function(t,e,s){s(1439)},8585:function(t,e,s){s(7585)},8696:function(t,e,s){s(5315)},5082:function(t,e,s){"use strict";s(7658),Object.defineProperty(e,"__esModule",{value:!0}),e.Transport=void 0;const i=s(6645),n="ion-sfu",r="no active session, join first";var o;(function(t){t[t["pub"]=0]="pub",t[t["sub"]=1]="sub"})(o||(o={}));class a{constructor(t,e,s){this.signal=e,this.pc=new RTCPeerConnection(s),this.candidates=[],t===o.pub&&this.pc.createDataChannel(n),this.pc.onicecandidate=({candidate:e})=>{e&&this.signal.trickle({target:t,candidate:e})},this.pc.oniceconnectionstatechange=async t=>{"disconnected"===this.pc.iceConnectionState&&void 0!==this.pc.restartIce&&this.pc.restartIce()}}}e.Transport=a;class c{constructor(t,e={codec:"vp8",iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]}]}){this.signal=t,this.config=e,t.onnegotiate=this.negotiate.bind(this),t.ontrickle=this.trickle.bind(this)}async join(t,e){this.transports={[o.pub]:new a(o.pub,this.signal,this.config),[o.sub]:new a(o.sub,this.signal,this.config)},this.transports[o.sub].pc.ontrack=t=>{const e=t.streams[0],s=i.makeRemote(e,this.transports[o.sub]);this.ontrack&&this.ontrack(t.track,s)};const s=new Promise((t=>{this.transports[o.sub].pc.ondatachannel=e=>{if(e.channel.label===n)return this.transports[o.sub].api=e.channel,this.transports[o.pub].api=e.channel,e.channel.onmessage=t=>{try{const e=JSON.parse(t.data);this.processChannelMessage(e)}catch(e){console.error(e)}},void t();this.ondatachannel&&this.ondatachannel(e)}})),r=await this.transports[o.pub].pc.createOffer();await this.transports[o.pub].pc.setLocalDescription(r);const c=await this.signal.join(t,e,r);return await this.transports[o.pub].pc.setRemoteDescription(c),this.transports[o.pub].candidates.forEach((t=>this.transports[o.pub].pc.addIceCandidate(t))),this.transports[o.pub].pc.onnegotiationneeded=this.onNegotiationNeeded.bind(this),s}leave(){this.transports&&(Object.values(this.transports).forEach((t=>t.pc.close())),delete this.transports)}getPubStats(t){if(!this.transports)throw Error(r);return this.transports[o.pub].pc.getStats(t)}getSubStats(t){if(!this.transports)throw Error(r);return this.transports[o.sub].pc.getStats(t)}publish(t,e){if(!this.transports)throw Error(r);t.publish(this.transports[o.pub],e)}restartIce(){this.renegotiate(!0)}createDataChannel(t){if(!this.transports)throw Error(r);return this.transports[o.pub].pc.createDataChannel(t)}close(){this.transports&&Object.values(this.transports).forEach((t=>t.pc.close())),this.signal.close()}trickle({candidate:t,target:e}){if(!this.transports)throw Error(r);this.transports[e].pc.remoteDescription?this.transports[e].pc.addIceCandidate(t):this.transports[e].candidates.push(t)}async negotiate(t){if(!this.transports)throw Error(r);let e;try{await this.transports[o.sub].pc.setRemoteDescription(t),this.transports[o.sub].candidates.forEach((t=>this.transports[o.sub].pc.addIceCandidate(t))),this.transports[o.sub].candidates=[],e=await this.transports[o.sub].pc.createAnswer(),await this.transports[o.sub].pc.setLocalDescription(e),this.signal.answer(e)}catch(s){console.error(s),this.onerrnegotiate&&this.onerrnegotiate(o.sub,s,t,e)}}onNegotiationNeeded(){this.renegotiate(!1)}async renegotiate(t){if(!this.transports)throw Error(r);let e,s;try{e=await this.transports[o.pub].pc.createOffer({iceRestart:t}),await this.transports[o.pub].pc.setLocalDescription(e),s=await this.signal.offer(e),await this.transports[o.pub].pc.setRemoteDescription(s)}catch(i){console.error(i),this.onerrnegotiate&&this.onerrnegotiate(o.pub,i,e,s)}}processChannelMessage(t){if(void 0!==t.method&&void 0!==t.params)switch(t.method){case"audioLevels":this.onspeaker&&this.onspeaker(t.params);break;case"activeLayer":this.onactivelayer&&this.onactivelayer(t.params);break;default:}else this.onspeaker&&this.onspeaker(t)}}e["default"]=c},2630:function(t,e,s){"use strict";e.WH=e.KU=void 0;const i=s(5082);e.KU=i.default;const n=s(6645);Object.defineProperty(e,"WH",{enumerable:!0,get:function(){return n.LocalStream}})},8139:function(t,e,s){"use strict";e.Q=void 0;const i=s(759);class n{constructor(t){this.socket=new WebSocket(t),this._notifyhandlers={},this.socket.addEventListener("open",(()=>{this._onopen&&this._onopen()})),this.socket.addEventListener("error",(t=>{this._onerror&&this._onerror(t)})),this.socket.addEventListener("close",(t=>{this._onclose&&this._onclose(t)})),this.socket.addEventListener("message",(async t=>{const e=JSON.parse(t.data);if("offer"===e.method)this.onnegotiate&&this.onnegotiate(e.params);else if("trickle"===e.method)this.ontrickle&&this.ontrickle(e.params);else{const t=this._notifyhandlers[e.method];t&&t(e.params)}}))}on_notify(t,e){this._notifyhandlers[t]=e}async call(t,e){const s=i.v4();return this.socket.send(JSON.stringify({method:t,params:e,id:s})),new Promise(((t,e)=>{const i=n=>{const r=JSON.parse(n.data);r.id===s&&(r.error?e(r.error):t(r.result),this.socket.removeEventListener("message",i))};this.socket.addEventListener("message",i)}))}notify(t,e){this.socket.send(JSON.stringify({method:t,params:e}))}async join(t,e,s){return this.call("join",{sid:t,uid:e,offer:s})}trickle(t){this.notify("trickle",t)}async offer(t){return this.call("offer",{desc:t})}answer(t){this.notify("answer",{desc:t})}close(){this.socket.close()}set onopen(t){this.socket.readyState===WebSocket.OPEN&&t(),this._onopen=t}set onerror(t){this._onerror=t}set onclose(t){this._onclose=t}}e.Q=n},6645:function(t,e,s){"use strict";s(7658),Object.defineProperty(e,"__esModule",{value:!0}),e.makeRemote=e.LocalStream=e.VideoConstraints=void 0;const i=["qvga","vga","shd","hd","fhd","qhd"];e.VideoConstraints={qvga:{resolution:{width:{ideal:320},height:{ideal:180},frameRate:{ideal:15,max:30}},encodings:{maxBitrate:15e4,maxFramerate:15}},vga:{resolution:{width:{ideal:640},height:{ideal:360},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:5e5,maxFramerate:30}},shd:{resolution:{width:{ideal:960},height:{ideal:540},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:12e5,maxFramerate:30}},hd:{resolution:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:25e5,maxFramerate:30}},fhd:{resolution:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:4e6,maxFramerate:30}},qhd:{resolution:{width:{ideal:2560},height:{ideal:1440},frameRate:{ideal:30,max:60}},encodings:{maxBitrate:8e6,maxFramerate:30}}};const n={resolution:"hd",codec:"vp8",audio:!0,video:!0,simulcast:!1};class r extends MediaStream{constructor(t,e){super(t),this.constraints=e}static async getUserMedia(t=n){const e=await navigator.mediaDevices.getUserMedia({audio:r.computeAudioConstraints({...n,...t}),video:r.computeVideoConstraints({...n,...t})});return new r(e,{...n,...t})}static async getDisplayMedia(t={codec:"vp8",resolution:"hd",audio:!1,video:!0,simulcast:!1}){const e=await navigator.mediaDevices.getDisplayMedia(t);return new r(e,{...n,...t})}static computeAudioConstraints(t){return t.audio}static computeVideoConstraints(t){return t.video instanceof Object?t.video:t.video&&t.resolution?{...e.VideoConstraints[t.resolution].resolution}:t.video}getTrack(t){let e;return"video"===t?(e=this.getVideoTracks(),e.length>0?this.getVideoTracks()[0]:void 0):(e=this.getAudioTracks(),e.length>0?this.getAudioTracks()[0]:void 0)}async getNewTrack(t){const e=await navigator.mediaDevices.getUserMedia({[t]:"video"===t?r.computeVideoConstraints(this.constraints):r.computeAudioConstraints(this.constraints)});return e.getTracks()[0]}publishTrack(t){if(this.pc){const s={streams:[this],direction:"sendonly"};if("video"===t.kind)if(this.encodingParams)s.sendEncodings=this.encodingParams;else if(this.constraints.simulcast){const t=i.indexOf(this.constraints.resolution),n=[{rid:"f",maxBitrate:e.VideoConstraints[i[t]].encodings.maxBitrate,maxFramerate:e.VideoConstraints[i[t]].encodings.maxFramerate}];t-1>=0&&n.push({rid:"h",scaleResolutionDownBy:2,maxBitrate:e.VideoConstraints[i[t-1]].encodings.maxBitrate,maxFramerate:e.VideoConstraints[i[t-1]].encodings.maxFramerate}),t-2>=0&&n.push({rid:"q",scaleResolutionDownBy:4,maxBitrate:e.VideoConstraints[i[t-2]].encodings.maxBitrate,maxFramerate:e.VideoConstraints[i[t-2]].encodings.maxFramerate}),s.sendEncodings=n}else s.sendEncodings=[e.VideoConstraints[this.constraints.resolution].encodings];const n=this.pc.addTransceiver(t,s);this.setPreferredCodec(n,t.kind)}}setPreferredCodec(t,e){if("setCodecPreferences"in t){const s=RTCRtpSender.getCapabilities(e);if(!s)return;let i;if(this.constraints.preferredCodecProfile&&"video"===e){const t=s.codecs.filter((t=>t.mimeType.toLowerCase()===`video/${this.constraints.codec.toLowerCase()}`));if(!t)return;i=t.find((t=>{var e;return t.sdpFmtpLine&&(null===(e=t.sdpFmtpLine)||void 0===e?void 0:e.indexOf(`profile-level-id=${this.constraints.preferredCodecProfile}`))>=0})),i||(i=t[0])}else i=s.codecs.find((t=>t.mimeType.toLowerCase()===`video/${this.constraints.codec.toLowerCase()}`||"audio/opus"===t.mimeType.toLowerCase()));i&&t.setCodecPreferences([i])}}updateTrack(t,e){this.addTrack(t),e?(this.removeTrack(e),e.stop(),this.pc&&this.pc.getSenders().forEach((async e=>{var s,i;(null===(s=null===e||void 0===e?void 0:e.track)||void 0===s?void 0:s.kind)===t.kind&&(null===(i=e.track)||void 0===i||i.stop(),e.replaceTrack(t))}))):this.pc&&this.publishTrack(t)}initAudioEmptyTrack(){const t=window.AudioContext||window.webkitAudioContext,e=new t,s=e.createOscillator();s.frequency.setValueAtTime(2e4,e.currentTime);const i=s.connect(e.createMediaStreamDestination());return s.start(),i.stream.getAudioTracks()[0]}initVideoEmptyTrack(t,e){var s;const i=Object.assign(document.createElement("canvas"),{width:t,height:e});null===(s=i.getContext("2d"))||void 0===s||s.fillRect(0,0,t,e);const n=i.captureStream();return n.getVideoTracks()[0]}publish(t,e){this.pc=t.pc,this.api=t.api,this.encodingParams=e,this.getTracks().forEach(this.publishTrack.bind(this))}unpublish(){if(this.pc){const t=this.getTracks();this.pc.getSenders().forEach((e=>{e.track&&t.includes(e.track)&&this.pc.removeTrack(e)}))}}async switchDevice(t,e){this.constraints={...this.constraints,[t]:this.constraints[t]instanceof Object?{...this.constraints[t],deviceId:e}:{deviceId:e}};const s=this.getTrack(t);s&&s.stop();const i=await this.getNewTrack(t);this.updateTrack(i,s)}mute(t){const e=this.getTrack(t);if(e&&this.constraints.sendEmptyOnMute){const s="audio"===t?this.initAudioEmptyTrack():this.initVideoEmptyTrack((null===e||void 0===e?void 0:e.getSettings().width)||640,(null===e||void 0===e?void 0:e.getSettings().height)||360);return s.enabled=!1,void this.updateTrack(s,e)}e&&e.stop()}async unmute(t){const e=this.getTrack(t),s=await this.getNewTrack(t);this.updateTrack(s,e)}async enableLayers(t){const e={streamId:this.id,layers:t};JSON.stringify(e);this.api&&("open"!==this.api.readyState?this.api.onopen=()=>{var t;return null===(t=this.api)||void 0===t?void 0:t.send(JSON.stringify(e))}:this.api.send(JSON.stringify(e)));const s=["high","medium","low"];await Promise.all(s.map((async e=>{await this.updateMediaEncodingParams({active:t.includes(e)},e)})))}async updateMediaEncodingParams(t,e){var s;if(!this.pc)return;const i=this.getTracks();await Promise.all(null===(s=this.pc)||void 0===s?void 0:s.getSenders().filter((t=>t.track&&i.includes(t.track))).map((async s=>{const i=s.getParameters();i.encodings||(i.encodings=[{}]);let n=0;if(this.constraints.simulcast&&e){const t="high"===e?"f":"medium"===e?"h":"q";if(n=i.encodings.findIndex((e=>e.rid===t)),i.encodings.length<n+1)return}i.encodings[n]={...i.encodings[n],...t},await s.setParameters(i)})))}}function o(t,e){const s=t;s.audio=!0,s.video="none",s.framerate="high",s._videoPreMute="high";const i=()=>{const t={streamId:s.id,video:s.video,audio:s.audio,framerate:s.framerate};e.api&&("open"!==e.api.readyState?e.api.onopen=()=>{var s;return null===(s=e.api)||void 0===s?void 0:s.send(JSON.stringify(t))}:e.api.send(JSON.stringify(t)))};return s.preferLayer=t=>{s.video=t,i()},s.preferFramerate=t=>{s.framerate=t,i()},s.mute=t=>{"audio"===t?s.audio=!1:"video"===t&&(s._videoPreMute=s.video,s.video="none"),i()},s.unmute=t=>{"audio"===t?s.audio=!0:"video"===t&&(s.video=s._videoPreMute),i()},s}e.LocalStream=r,e.makeRemote=o},759:function(t,e,s){"use strict";s.r(e),s.d(e,{NIL:function(){return K},parse:function(){return k},stringify:function(){return f},v1:function(){return v},v3:function(){return q},v4:function(){return V},v5:function(){return Y},validate:function(){return c},version:function(){return W}});s(3767),s(8585),s(8696);var i,n=new Uint8Array(16);function r(){if(!i&&(i="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!i))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(n)}s(7658);var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function a(t){return"string"===typeof t&&o.test(t)}for(var c=a,h=[],u=0;u<256;++u)h.push((u+256).toString(16).substr(1));function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=(h[t[e+0]]+h[t[e+1]]+h[t[e+2]]+h[t[e+3]]+"-"+h[t[e+4]]+h[t[e+5]]+"-"+h[t[e+6]]+h[t[e+7]]+"-"+h[t[e+8]]+h[t[e+9]]+"-"+h[t[e+10]]+h[t[e+11]]+h[t[e+12]]+h[t[e+13]]+h[t[e+14]]+h[t[e+15]]).toLowerCase();if(!c(s))throw TypeError("Stringified UUID is invalid");return s}var d,p,f=l,g=0,m=0;function y(t,e,s){var i=e&&s||0,n=e||new Array(16);t=t||{};var o=t.node||d,a=void 0!==t.clockseq?t.clockseq:p;if(null==o||null==a){var c=t.random||(t.rng||r)();null==o&&(o=d=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==a&&(a=p=16383&(c[6]<<8|c[7]))}var h=void 0!==t.msecs?t.msecs:Date.now(),u=void 0!==t.nsecs?t.nsecs:m+1,l=h-g+(u-m)/1e4;if(l<0&&void 0===t.clockseq&&(a=a+1&16383),(l<0||h>g)&&void 0===t.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=h,m=u,p=a,h+=122192928e5;var y=(1e4*(268435455&h)+u)%4294967296;n[i++]=y>>>24&255,n[i++]=y>>>16&255,n[i++]=y>>>8&255,n[i++]=255&y;var v=h/4294967296*1e4&268435455;n[i++]=v>>>8&255,n[i++]=255&v,n[i++]=v>>>24&15|16,n[i++]=v>>>16&255,n[i++]=a>>>8|128,n[i++]=255&a;for(var b=0;b<6;++b)n[i+b]=o[b];return e||f(n)}var v=y;function b(t){if(!c(t))throw TypeError("Invalid UUID");var e,s=new Uint8Array(16);return s[0]=(e=parseInt(t.slice(0,8),16))>>>24,s[1]=e>>>16&255,s[2]=e>>>8&255,s[3]=255&e,s[4]=(e=parseInt(t.slice(9,13),16))>>>8,s[5]=255&e,s[6]=(e=parseInt(t.slice(14,18),16))>>>8,s[7]=255&e,s[8]=(e=parseInt(t.slice(19,23),16))>>>8,s[9]=255&e,s[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,s[11]=e/4294967296&255,s[12]=e>>>24&255,s[13]=e>>>16&255,s[14]=e>>>8&255,s[15]=255&e,s}var k=b;function w(t){t=unescape(encodeURIComponent(t));for(var e=[],s=0;s<t.length;++s)e.push(t.charCodeAt(s));return e}var T="6ba7b810-9dad-11d1-80b4-00c04fd430c8",_="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function S(t,e,s){function i(t,i,n,r){if("string"===typeof t&&(t=w(t)),"string"===typeof i&&(i=k(i)),16!==i.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var o=new Uint8Array(16+t.length);if(o.set(i),o.set(t,i.length),o=s(o),o[6]=15&o[6]|e,o[8]=63&o[8]|128,n){r=r||0;for(var a=0;a<16;++a)n[r+a]=o[a];return n}return f(o)}try{i.name=t}catch(n){}return i.DNS=T,i.URL=_,i}function x(t){if("string"===typeof t){var e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(var s=0;s<e.length;++s)t[s]=e.charCodeAt(s)}return C(I(L(t),8*t.length))}function C(t){for(var e=[],s=32*t.length,i="0123456789abcdef",n=0;n<s;n+=8){var r=t[n>>5]>>>n%32&255,o=parseInt(i.charAt(r>>>4&15)+i.charAt(15&r),16);e.push(o)}return e}function A(t){return 14+(t+64>>>9<<4)+1}function I(t,e){t[e>>5]|=128<<e%32,t[A(e)-1]=e;for(var s=1732584193,i=-271733879,n=-1732584194,r=271733878,o=0;o<t.length;o+=16){var a=s,c=i,h=n,u=r;s=P(s,i,n,r,t[o],7,-680876936),r=P(r,s,i,n,t[o+1],12,-389564586),n=P(n,r,s,i,t[o+2],17,606105819),i=P(i,n,r,s,t[o+3],22,-1044525330),s=P(s,i,n,r,t[o+4],7,-176418897),r=P(r,s,i,n,t[o+5],12,1200080426),n=P(n,r,s,i,t[o+6],17,-1473231341),i=P(i,n,r,s,t[o+7],22,-45705983),s=P(s,i,n,r,t[o+8],7,1770035416),r=P(r,s,i,n,t[o+9],12,-1958414417),n=P(n,r,s,i,t[o+10],17,-42063),i=P(i,n,r,s,t[o+11],22,-1990404162),s=P(s,i,n,r,t[o+12],7,1804603682),r=P(r,s,i,n,t[o+13],12,-40341101),n=P(n,r,s,i,t[o+14],17,-1502002290),i=P(i,n,r,s,t[o+15],22,1236535329),s=B(s,i,n,r,t[o+1],5,-165796510),r=B(r,s,i,n,t[o+6],9,-1069501632),n=B(n,r,s,i,t[o+11],14,643717713),i=B(i,n,r,s,t[o],20,-373897302),s=B(s,i,n,r,t[o+5],5,-701558691),r=B(r,s,i,n,t[o+10],9,38016083),n=B(n,r,s,i,t[o+15],14,-660478335),i=B(i,n,r,s,t[o+4],20,-405537848),s=B(s,i,n,r,t[o+9],5,568446438),r=B(r,s,i,n,t[o+14],9,-1019803690),n=B(n,r,s,i,t[o+3],14,-187363961),i=B(i,n,r,s,t[o+8],20,1163531501),s=B(s,i,n,r,t[o+13],5,-1444681467),r=B(r,s,i,n,t[o+2],9,-51403784),n=B(n,r,s,i,t[o+7],14,1735328473),i=B(i,n,r,s,t[o+12],20,-1926607734),s=M(s,i,n,r,t[o+5],4,-378558),r=M(r,s,i,n,t[o+8],11,-2022574463),n=M(n,r,s,i,t[o+11],16,1839030562),i=M(i,n,r,s,t[o+14],23,-35309556),s=M(s,i,n,r,t[o+1],4,-1530992060),r=M(r,s,i,n,t[o+4],11,1272893353),n=M(n,r,s,i,t[o+7],16,-155497632),i=M(i,n,r,s,t[o+10],23,-1094730640),s=M(s,i,n,r,t[o+13],4,681279174),r=M(r,s,i,n,t[o],11,-358537222),n=M(n,r,s,i,t[o+3],16,-722521979),i=M(i,n,r,s,t[o+6],23,76029189),s=M(s,i,n,r,t[o+9],4,-640364487),r=M(r,s,i,n,t[o+12],11,-421815835),n=M(n,r,s,i,t[o+15],16,530742520),i=M(i,n,r,s,t[o+2],23,-995338651),s=N(s,i,n,r,t[o],6,-198630844),r=N(r,s,i,n,t[o+7],10,1126891415),n=N(n,r,s,i,t[o+14],15,-1416354905),i=N(i,n,r,s,t[o+5],21,-57434055),s=N(s,i,n,r,t[o+12],6,1700485571),r=N(r,s,i,n,t[o+3],10,-1894986606),n=N(n,r,s,i,t[o+10],15,-1051523),i=N(i,n,r,s,t[o+1],21,-2054922799),s=N(s,i,n,r,t[o+8],6,1873313359),r=N(r,s,i,n,t[o+15],10,-30611744),n=N(n,r,s,i,t[o+6],15,-1560198380),i=N(i,n,r,s,t[o+13],21,1309151649),s=N(s,i,n,r,t[o+4],6,-145523070),r=N(r,s,i,n,t[o+11],10,-1120210379),n=N(n,r,s,i,t[o+2],15,718787259),i=N(i,n,r,s,t[o+9],21,-343485551),s=E(s,a),i=E(i,c),n=E(n,h),r=E(r,u)}return[s,i,n,r]}function L(t){if(0===t.length)return[];for(var e=8*t.length,s=new Uint32Array(A(e)),i=0;i<e;i+=8)s[i>>5]|=(255&t[i/8])<<i%32;return s}function E(t,e){var s=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(s>>16);return i<<16|65535&s}function R(t,e){return t<<e|t>>>32-e}function O(t,e,s,i,n,r){return E(R(E(E(e,t),E(i,r)),n),s)}function P(t,e,s,i,n,r,o){return O(e&s|~e&i,t,e,n,r,o)}function B(t,e,s,i,n,r,o){return O(e&i|s&~i,t,e,n,r,o)}function M(t,e,s,i,n,r,o){return O(e^s^i,t,e,n,r,o)}function N(t,e,s,i,n,r,o){return O(s^(e|~i),t,e,n,r,o)}var D=x,j=S("v3",48,D),q=j;function U(t,e,s){t=t||{};var i=t.random||(t.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){s=s||0;for(var n=0;n<16;++n)e[s+n]=i[n];return e}return f(i)}var V=U;function $(t,e,s,i){switch(t){case 0:return e&s^~e&i;case 1:return e^s^i;case 2:return e&s^e&i^s&i;case 3:return e^s^i}}function G(t,e){return t<<e|t>>>32-e}function F(t){var e=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"===typeof t){var i=unescape(encodeURIComponent(t));t=[];for(var n=0;n<i.length;++n)t.push(i.charCodeAt(n))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var r=t.length/4+2,o=Math.ceil(r/16),a=new Array(o),c=0;c<o;++c){for(var h=new Uint32Array(16),u=0;u<16;++u)h[u]=t[64*c+4*u]<<24|t[64*c+4*u+1]<<16|t[64*c+4*u+2]<<8|t[64*c+4*u+3];a[c]=h}a[o-1][14]=8*(t.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(t.length-1)&4294967295;for(var l=0;l<o;++l){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=a[l][p];for(var f=16;f<80;++f)d[f]=G(d[f-3]^d[f-8]^d[f-14]^d[f-16],1);for(var g=s[0],m=s[1],y=s[2],v=s[3],b=s[4],k=0;k<80;++k){var w=Math.floor(k/20),T=G(g,5)+$(w,m,y,v)+b+e[w]+d[k]>>>0;b=v,v=y,y=G(m,30)>>>0,m=g,g=T}s[0]=s[0]+g>>>0,s[1]=s[1]+m>>>0,s[2]=s[2]+y>>>0,s[3]=s[3]+v>>>0,s[4]=s[4]+b>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,255&s[0],s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,255&s[1],s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,255&s[2],s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,255&s[3],s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,255&s[4]]}var H=F,z=S("v5",80,H),Y=z,K="00000000-0000-0000-0000-000000000000";function J(t){if(!c(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)}var W=J},217:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return ys}});var i={};s.r(i),s.d(i,{Decoder:function(){return rs},Encoder:function(){return ns},PacketType:function(){return is},protocol:function(){return ss}});var n=s(3396),r=s(7139),o=s(9242),a=s.p+"img/Avatar.bd172d34.png",c=s(5427),h=s(9289),u=s(162);const l=t=>((0,n.dD)("data-v-8ad2f086"),t=t(),(0,n.Cn)(),t),d={ref:"body"},p={class:"container"},f={class:"main"},g={ref:"videoBox",class:"videoBox"},m={class:"usernameSpan"},y={class:"videoInfo"},v=["src"],b=["src"],k=["srcObject","muted"],w={class:"videoControl"},T=["onClick","src"],_={key:0},S=(0,n.uE)('<option value="qvga" data-v-8ad2f086>qvga</option><option value="vga" data-v-8ad2f086>vga</option><option value="shd" data-v-8ad2f086>shd</option><option value="hd" data-v-8ad2f086>hd</option><option value="fhd" data-v-8ad2f086>fhd</option><option value="qhd" data-v-8ad2f086>qhd</option>',6),x=[S],C={key:1},A=["onClick","name"],I=["onClick","name"],L=["onClick","name"],E={class:"usernameSpan"},R={class:"videoInfo"},O=["src"],P=["srcObject","muted"],B={class:"videoControl"},M=["onClick","src"],N={class:"controlBox"},D=["disabled"],j=["src"],q=["disabled"],U=["src"],V=["disabled"],$=["src"],G=["src"],F=["src"],H=["src"],z=["src"],Y={class:"messageBox",ref:"messageBox"},K=l((()=>(0,n._)("h4",null,"Chat",-1))),J={class:"messageInfo",ref:"messageInfo"},W={key:0,class:"selfMessage"},Q={class:"username"},X=l((()=>(0,n._)("img",{src:a,alt:""},null,-1))),Z={key:1,class:"otherMessage"},tt=l((()=>(0,n._)("img",{src:a,alt:""},null,-1))),et={class:"username"},st={class:"sendBox"},it=l((()=>(0,n._)("img",{src:c,alt:""},null,-1))),nt=[it],rt={class:"userInfoListBox",ref:"userInfoListBox"},ot=l((()=>(0,n._)("h4",null,"Participants",-1))),at={class:"userInfoListUl"},ct={class:"userWrapper"},ht=l((()=>(0,n._)("div",{class:"userAvatar"},[(0,n._)("img",{src:a})],-1))),ut={class:"userInfo"},lt={class:"username"},dt={class:"userActions"},pt=["onClick"],ft=["src"],gt={class:"chatGPTBox",ref:"chatGPTBox"},mt=l((()=>(0,n._)("h4",null,"ChatGPT",-1))),yt={class:"chatGPTInfo",ref:"chatGPTInfo"},vt={key:0,class:"selfMessage"},bt=["onClick"],kt={key:1,class:"otherMessage"},wt=["onClick"],Tt={class:"sendBox"},_t=["disabled"],St=l((()=>(0,n._)("img",{src:h,alt:""},null,-1))),xt=[St],Ct=["disabled"],At=l((()=>(0,n._)("img",{src:u,alt:""},null,-1))),It=[At],Lt=l((()=>(0,n._)("img",{src:c,alt:""},null,-1))),Et=[Lt];function Rt(t,e,i,a,c,h){return(0,n.wg)(),(0,n.iD)("body",d,[(0,n._)("div",p,[(0,n._)("div",f,[(0,n._)("div",g,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(h.filteredUserInfoList,((t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,null,[null!=t.streamId?((0,n.wg)(),(0,n.iD)("div",{key:i,class:"videoWrapper"},[(0,n._)("div",m,[(0,n._)("span",null,(0,r.zw)(t.name),1)]),(0,n._)("div",y,[(0,n._)("img",{src:t.audioMute?s(503):s(927),alt:""},null,8,v),(0,n._)("img",{src:t.videoMute?s(1291):s(880),alt:""},null,8,b)]),(0,n._)("video",{srcObject:c.streams[t.streamId],muted:c.muteState[t.streamId],autoplay:"",class:"video"},null,8,k),(0,n._)("div",w,[(0,n._)("img",{onClick:e=>h.controlRemoteAudio(t.streamId),src:c.muteState[t.streamId]?s(5053):s(1206),alt:"静音"},null,8,T),c.streams[t.streamId]===c.localStream?((0,n.wg)(),(0,n.iD)("div",_,[(0,n.wy)((0,n._)("select",{id:"resolution","onUpdate:modelValue":e[0]||(e[0]=t=>c.resolution=t),onChange:e[1]||(e[1]=(...t)=>h.onResolutionChange&&h.onResolutionChange(...t))},x,544),[[o.bM,c.resolution]])])):(0,n.kq)("",!0),c.streams[t.streamId]!==c.localStream?((0,n.wg)(),(0,n.iD)("div",C,[(0,n._)("div",null,[(0,n._)("label",null,[(0,n._)("input",{type:"radio",onClick:e=>h.controlSimulcast(c.streams[t.streamId],"high"),value:"high",name:t.streamId,checked:""},null,8,A),(0,n.Uk)("High")])]),(0,n._)("div",null,[(0,n._)("label",null,[(0,n._)("input",{type:"radio",onClick:e=>h.controlSimulcast(c.streams[t.streamId],"medium"),value:"medium",name:t.streamId},null,8,I),(0,n.Uk)("Medium")])]),(0,n._)("div",null,[(0,n._)("label",null,[(0,n._)("input",{type:"radio",onClick:e=>h.controlSimulcast(c.streams[t.streamId],"low"),value:"low",name:t.streamId},null,8,L),(0,n.Uk)("Low")])])])):(0,n.kq)("",!0)])])):(0,n.kq)("",!0),null!=t.shareId?((0,n.wg)(),(0,n.iD)("div",{key:i,class:"videoWrapper"},[(0,n._)("div",E,[(0,n._)("span",null,(0,r.zw)(t.name+"-Screen"),1)]),(0,n._)("div",R,[(0,n._)("img",{src:t.audioMute?s(503):s(927),alt:""},null,8,O)]),(0,n._)("video",{srcObject:c.streams[t.shareId],muted:c.muteState[t.shareId],autoplay:"",class:"video"},null,8,P),(0,n._)("div",B,[(0,n._)("img",{onClick:e=>h.controlRemoteAudio(t.shareId),src:c.muteState[t.shareId]?s(5053):s(1206),alt:"静音"},null,8,M)])])):(0,n.kq)("",!0)],64)))),256))],512),(0,n._)("footer",null,[(0,n._)("div",N,[(0,n._)("button",{onClick:e[2]||(e[2]=(...t)=>h.controlLocalVideo&&h.controlLocalVideo(...t)),disabled:!c.isPublishStream},[(0,n._)("img",{src:c.videoMute?s(6939):s(6779),id:"videoControlIcon",alt:""},null,8,j)],8,D),(0,n._)("button",{onClick:e[3]||(e[3]=(...t)=>h.controlLocalAudio&&h.controlLocalAudio(...t)),disabled:!c.isPublishStream},[(0,n._)("img",{src:c.audioMute?s(162):s(9289),id:"audioControlIcon",alt:""},null,8,U)],8,q),(0,n._)("button",{style:(0,r.j5)(c.isShareStream?{background:"red"}:{}),ref:"shareBtn",onClick:e[4]||(e[4]=(...t)=>h.controlShareStream&&h.controlShareStream(...t)),disabled:!c.isPublishStream},[(0,n._)("img",{src:s(6058),alt:""},null,8,$)],12,V),(0,n._)("button",{style:(0,r.j5)(c.isPublishStream?{background:"red"}:{background:"limegreen"}),ref:"callBtn",onClick:e[5]||(e[5]=(...t)=>h.controlLocalStream&&h.controlLocalStream(...t))},[(0,n._)("img",{src:c.isPublishStream?s(2053):s(1642),alt:""},null,8,G)],4),(0,n._)("button",{onClick:e[6]||(e[6]=(...t)=>h.controlMessageBox&&h.controlMessageBox(...t))},[(0,n._)("img",{src:s(7069),alt:""},null,8,F)]),(0,n._)("button",{onClick:e[7]||(e[7]=(...t)=>h.controlUserInfoBox&&h.controlUserInfoBox(...t))},[(0,n._)("img",{src:s(9389),alt:""},null,8,H)]),(0,n._)("button",{onClick:e[8]||(e[8]=(...t)=>h.controlChatGPTBox&&h.controlChatGPTBox(...t))},[(0,n._)("img",{src:s(6951),alt:""},null,8,z)])])])]),(0,n._)("div",Y,[K,(0,n._)("div",J,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(c.messages,((t,e)=>((0,n.wg)(),(0,n.iD)("div",{key:e},[t.isSelf?((0,n.wg)(),(0,n.iD)("div",W,[(0,n._)("div",null,[(0,n._)("span",Q,(0,r.zw)(c.userInfoList[t.socketId].name),1),(0,n._)("p",null,(0,r.zw)(t.text),1)]),X])):((0,n.wg)(),(0,n.iD)("div",Z,[tt,(0,n._)("div",null,[(0,n._)("span",et,(0,r.zw)(c.userInfoList[t.socketId].name),1),(0,n._)("p",null,(0,r.zw)(t.text),1)])]))])))),128))],512),(0,n._)("div",st,[(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":e[9]||(e[9]=t=>c.messageText=t),placeholder:"Write...",onKeyup:e[10]||(e[10]=(0,o.D2)(((...t)=>h.sendMessage&&h.sendMessage(...t)),["enter"])),rows:"3",cols:"50"},null,544),[[o.nr,c.messageText]]),(0,n._)("button",{class:"icon-button",onClick:e[11]||(e[11]=(...t)=>h.sendMessage&&h.sendMessage(...t))},nt)])],512),(0,n._)("div",rt,[ot,(0,n._)("ul",at,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(c.userInfoList,((t,e)=>((0,n.wg)(),(0,n.iD)("li",{key:e,class:"userInfoListLi"},[(0,n._)("div",ct,[ht,(0,n._)("div",ut,[(0,n._)("span",lt,(0,r.zw)(t.name),1)]),(0,n._)("div",dt,[t.streamId?((0,n.wg)(),(0,n.iD)("button",{key:0,onClick:e=>h.controlRemoteAudio(t.streamId)},[(0,n._)("img",{src:c.muteState[t.streamId]?s(5053):s(8502)},null,8,ft)],8,pt)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n.Uk)(" no signal ")],64))])])])))),128))])],512),(0,n._)("div",gt,[mt,(0,n._)("div",yt,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(c.chatGPTMessages,((t,e)=>((0,n.wg)(),(0,n.iD)("div",{key:e},["user"===t.sender?((0,n.wg)(),(0,n.iD)("div",vt,[(0,n._)("div",{onClick:e=>h.speakChatGPTMessage(t.text)},[(0,n._)("p",null,(0,r.zw)(t.text),1)],8,bt)])):((0,n.wg)(),(0,n.iD)("div",kt,[(0,n._)("div",{onClick:e=>h.speakChatGPTMessage(t.text)},[(0,n._)("p",null,(0,r.zw)(t.text),1)],8,wt)]))])))),128))],512),(0,n._)("div",Tt,[(0,n.wy)((0,n._)("textarea",{"onUpdate:modelValue":e[12]||(e[12]=t=>c.chatGPTMessageText=t),placeholder:"请输入您的问题...",onKeyup:e[13]||(e[13]=(0,o.D2)(((...t)=>h.sendChatGPTMessage&&h.sendChatGPTMessage(...t)),["enter"])),rows:"3",cols:"50"},null,544),[[o.nr,c.chatGPTMessageText]]),c.isRecognizing?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("button",{key:0,onClick:e[14]||(e[14]=(...t)=>h.startSpeechRecognition&&h.startSpeechRecognition(...t)),disabled:c.isRecognizing,class:"icon-button"},xt,8,_t)),c.isRecognizing?((0,n.wg)(),(0,n.iD)("button",{key:1,onClick:e[15]||(e[15]=(...t)=>h.stopSpeechRecognition&&h.stopSpeechRecognition(...t)),disabled:!c.isRecognizing,class:"icon-button"},It,8,Ct)):(0,n.kq)("",!0),(0,n._)("button",{class:"icon-button",onClick:e[16]||(e[16]=(...t)=>h.sendChatGPTMessage&&h.sendChatGPTMessage(...t))},Et)])],512)])],512)}s(7658);var Ot=s(2630),Pt=s(8139);const Bt=Object.create(null);Bt["open"]="0",Bt["close"]="1",Bt["ping"]="2",Bt["pong"]="3",Bt["message"]="4",Bt["upgrade"]="5",Bt["noop"]="6";const Mt=Object.create(null);Object.keys(Bt).forEach((t=>{Mt[Bt[t]]=t}));const Nt={type:"error",data:"parser error"},Dt="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),jt="function"===typeof ArrayBuffer,qt=t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ut=({type:t,data:e},s,i)=>Dt&&e instanceof Blob?s?i(e):Vt(e,i):jt&&(e instanceof ArrayBuffer||qt(e))?s?i(e):Vt(new Blob([e]),i):i(Bt[t]+(e||"")),Vt=(t,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+(t||""))},s.readAsDataURL(t)};var $t=Ut;s(3767),s(8585),s(8696);const Gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ft="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let bs=0;bs<Gt.length;bs++)Ft[Gt.charCodeAt(bs)]=bs;const Ht=t=>{let e,s,i,n,r,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const h=new ArrayBuffer(o),u=new Uint8Array(h);for(e=0;e<a;e+=4)s=Ft[t.charCodeAt(e)],i=Ft[t.charCodeAt(e+1)],n=Ft[t.charCodeAt(e+2)],r=Ft[t.charCodeAt(e+3)],u[c++]=s<<2|i>>4,u[c++]=(15&i)<<4|n>>2,u[c++]=(3&n)<<6|63&r;return h},zt="function"===typeof ArrayBuffer,Yt=(t,e)=>{if("string"!==typeof t)return{type:"message",data:Jt(t,e)};const s=t.charAt(0);if("b"===s)return{type:"message",data:Kt(t.substring(1),e)};const i=Mt[s];return i?t.length>1?{type:Mt[s],data:t.substring(1)}:{type:Mt[s]}:Nt},Kt=(t,e)=>{if(zt){const s=Ht(t);return Jt(s,e)}return{base64:!0,data:t}},Jt=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}};var Wt=Yt;const Qt=String.fromCharCode(30),Xt=(t,e)=>{const s=t.length,i=new Array(s);let n=0;t.forEach(((t,r)=>{$t(t,!1,(t=>{i[r]=t,++n===s&&e(i.join(Qt))}))}))},Zt=(t,e)=>{const s=t.split(Qt),i=[];for(let n=0;n<s.length;n++){const t=Wt(s[n],e);if(i.push(t),"error"===t.type)break}return i},te=4;function ee(t){if(t)return se(t)}function se(t){for(var e in ee.prototype)t[e]=ee.prototype[e];return t}ee.prototype.on=ee.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},ee.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this},ee.prototype.off=ee.prototype.removeListener=ee.prototype.removeAllListeners=ee.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,i=this._callbacks["$"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<i.length;n++)if(s=i[n],s===e||s.fn===e){i.splice(n,1);break}return 0===i.length&&delete this._callbacks["$"+t],this},ee.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(s){s=s.slice(0);i=0;for(var n=s.length;i<n;++i)s[i].apply(this,e)}return this},ee.prototype.emitReserved=ee.prototype.emit,ee.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},ee.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ie=(()=>"undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")())();function ne(t,...e){return e.reduce(((e,s)=>(t.hasOwnProperty(s)&&(e[s]=t[s]),e)),{})}const re=ie.setTimeout,oe=ie.clearTimeout;function ae(t,e){e.useNativeTimers?(t.setTimeoutFn=re.bind(ie),t.clearTimeoutFn=oe.bind(ie)):(t.setTimeoutFn=ie.setTimeout.bind(ie),t.clearTimeoutFn=ie.clearTimeout.bind(ie))}const ce=1.33;function he(t){return"string"===typeof t?ue(t):Math.ceil((t.byteLength||t.size)*ce)}function ue(t){let e=0,s=0;for(let i=0,n=t.length;i<n;i++)e=t.charCodeAt(i),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(i++,s+=4);return s}class le extends Error{constructor(t,e,s){super(t),this.description=e,this.context=s,this.type="TransportError"}}class de extends ee{constructor(t){super(),this.writable=!1,ae(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,s){return super.emitReserved("error",new le(t,e,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=Wt(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}}const pe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),fe=64,ge={};let me,ye=0,ve=0;function be(t){let e="";do{e=pe[t%fe]+e,t=Math.floor(t/fe)}while(t>0);return e}function ke(){const t=be(+new Date);return t!==me?(ye=0,me=t):t+"."+be(ye++)}for(;ve<fe;ve++)ge[pe[ve]]=ve;function we(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}function Te(t){let e={},s=t.split("&");for(let i=0,n=s.length;i<n;i++){let t=s[i].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}let _e=!1;try{_e="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(vs){}const Se=_e;function xe(t){const e=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!e||Se))return new XMLHttpRequest}catch(s){}if(!e)try{return new(ie[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}function Ce(){}const Ae=function(){const t=new xe({xdomain:!1});return null!=t.responseType}();class Ie extends de{constructor(t){if(super(t),this.polling=!1,"undefined"!==typeof location){const e="https:"===location.protocol;let s=location.port;s||(s=e?"443":"80"),this.xd="undefined"!==typeof location&&t.hostname!==location.hostname||s!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=Ae&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const e=t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)};Zt(t,this.socket.binaryType).forEach(e),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,Xt(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ke()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const i=we(t),n=-1!==this.opts.hostname.indexOf(":");return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Le(this.uri(),t)}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e),s.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}class Le extends ee{constructor(t,e){super(),ae(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=ne(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new xe(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(s){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{e.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"===typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(s){return void this.setTimeoutFn((()=>{this.onError(s)}),0)}"undefined"!==typeof document&&(this.index=Le.requestsCount++,Le.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=Ce,t)try{this.xhr.abort()}catch(e){}"undefined"!==typeof document&&delete Le.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(Le.requestsCount=0,Le.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",Ee);else if("function"===typeof addEventListener){const t="onpagehide"in ie?"pagehide":"unload";addEventListener(t,Ee,!1)}function Ee(){for(let t in Le.requests)Le.requests.hasOwnProperty(t)&&Le.requests[t].abort()}const Re=(()=>{const t="function"===typeof Promise&&"function"===typeof Promise.resolve;return t?t=>Promise.resolve().then(t):(t,e)=>e(t,0)})(),Oe=ie.WebSocket||ie.MozWebSocket,Pe=!0,Be="arraybuffer",Me="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Ne extends de{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,s=Me?{}:ne(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=Pe&&!Me?e?new Oe(t,e):new Oe(t):new Oe(t,e,s)}catch(vs){return this.emitReserved("error",vs)}this.ws.binaryType=this.socket.binaryType||Be,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const s=t[e],i=e===t.length-1;$t(s,this.supportsBinary,(t=>{const e={};if(!Pe&&(s.options&&(e.compress=s.options.compress),this.opts.perMessageDeflate)){const s="string"===typeof t?Buffer.byteLength(t):t.length;s<this.opts.perMessageDeflate.threshold&&(e.compress=!1)}try{Pe?this.ws.send(t):this.ws.send(t,e)}catch(n){}i&&Re((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=ke()),this.supportsBinary||(t.b64=1);const i=we(t),n=-1!==this.opts.hostname.indexOf(":");return e+"://"+(n?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(i.length?"?"+i:"")}check(){return!!Oe}}const De={websocket:Ne,polling:Ie},je=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,qe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ue(t){const e=t,s=t.indexOf("["),i=t.indexOf("]");-1!=s&&-1!=i&&(t=t.substring(0,s)+t.substring(s,i).replace(/:/g,";")+t.substring(i,t.length));let n=je.exec(t||""),r={},o=14;while(o--)r[qe[o]]=n[o]||"";return-1!=s&&-1!=i&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=Ve(r,r["path"]),r.queryKey=$e(r,r["query"]),r}function Ve(t,e){const s=/\/{2,9}/g,i=e.replace(s,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||i.splice(0,1),"/"==e.slice(-1)&&i.splice(i.length-1,1),i}function $e(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){e&&(s[e]=i)})),s}class Ge extends ee{constructor(t,e={}){super(),this.writeBuffer=[],t&&"object"===typeof t&&(e=t,t=null),t?(t=Ue(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Ue(e.host).host),ae(this,e),this.secure=null!=e.secure?e.secure:"undefined"!==typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"===typeof this.opts.query&&(this.opts.query=Te(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"===typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=te,e.transport=t,this.id&&(e.sid=this.id);const s=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new De[t](s)}open(){let t;if(this.opts.rememberUpgrade&&Ge.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),s=!1;Ge.priorWebsocketSuccess=!1;const i=()=>{s||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!s)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;Ge.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{s||"closed"!==this.readyState&&(h(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function n(){s||(s=!0,h(),e.close(),e=null)}const r=t=>{const s=new Error("probe error: "+t);s.transport=e.name,n(),this.emitReserved("upgradeError",s)};function o(){r("transport closed")}function a(){r("socket closed")}function c(t){e&&t.name!==e.name&&n()}const h=()=>{e.removeListener("open",i),e.removeListener("error",r),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",i),e.once("error",r),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",Ge.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){const t=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!t)return this.writeBuffer;let e=1;for(let s=0;s<this.writeBuffer.length;s++){const t=this.writeBuffer[s].data;if(t&&(e+=he(t)),s>0&&e>this.maxPayload)return this.writeBuffer.slice(0,s);e+=2}return this.writeBuffer}write(t,e,s){return this.sendPacket("message",t,e,s),this}send(t,e,s){return this.sendPacket("message",t,e,s),this}sendPacket(t,e,s,i){if("function"===typeof e&&(i=e,e=void 0),"function"===typeof s&&(i=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;s=s||{},s.compress=!1!==s.compress;const n={type:t,data:e,options:s};this.emitReserved("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},s=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?s():t()})):this.upgrading?s():t()),this}onError(t){Ge.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let s=0;const i=t.length;for(;s<i;s++)~this.transports.indexOf(t[s])&&e.push(t[s]);return e}}Ge.protocol=te;Ge.protocol;function Fe(t,e="",s){let i=t;s=s||"undefined"!==typeof location&&location,null==t&&(t=s.protocol+"//"+s.host),"string"===typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?s.protocol+t:s.host+t),/^(https?|wss?):\/\//.test(t)||(t="undefined"!==typeof s?s.protocol+"//"+t:"https://"+t),i=Ue(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const n=-1!==i.host.indexOf(":"),r=n?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+r+":"+i.port+e,i.href=i.protocol+"://"+r+(s&&s.port===i.port?"":":"+i.port),i}s(2087),s(541);const He="function"===typeof ArrayBuffer,ze=t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Ye=Object.prototype.toString,Ke="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Ye.call(Blob),Je="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Ye.call(File);function We(t){return He&&(t instanceof ArrayBuffer||ze(t))||Ke&&t instanceof Blob||Je&&t instanceof File}function Qe(t,e){if(!t||"object"!==typeof t)return!1;if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++)if(Qe(t[e]))return!0;return!1}if(We(t))return!0;if(t.toJSON&&"function"===typeof t.toJSON&&1===arguments.length)return Qe(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&Qe(t[s]))return!0;return!1}function Xe(t){const e=[],s=t.data,i=t;return i.data=Ze(s,e),i.attachments=e.length,{packet:i,buffers:e}}function Ze(t,e){if(!t)return t;if(We(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}if(Array.isArray(t)){const s=new Array(t.length);for(let i=0;i<t.length;i++)s[i]=Ze(t[i],e);return s}if("object"===typeof t&&!(t instanceof Date)){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=Ze(t[i],e));return s}return t}function ts(t,e){return t.data=es(t.data,e),delete t.attachments,t}function es(t,e){if(!t)return t;if(t&&!0===t._placeholder){const s="number"===typeof t.num&&t.num>=0&&t.num<e.length;if(s)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=es(t[s],e);else if("object"===typeof t)for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=es(t[s],e));return t}const ss=5;var is;(function(t){t[t["CONNECT"]=0]="CONNECT",t[t["DISCONNECT"]=1]="DISCONNECT",t[t["EVENT"]=2]="EVENT",t[t["ACK"]=3]="ACK",t[t["CONNECT_ERROR"]=4]="CONNECT_ERROR",t[t["BINARY_EVENT"]=5]="BINARY_EVENT",t[t["BINARY_ACK"]=6]="BINARY_ACK"})(is||(is={}));class ns{constructor(t){this.replacer=t}encode(t){return t.type!==is.EVENT&&t.type!==is.ACK||!Qe(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===is.EVENT?is.BINARY_EVENT:is.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==is.BINARY_EVENT&&t.type!==is.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=Xe(t),s=this.encodeAsString(e.packet),i=e.buffers;return i.unshift(s),i}}class rs extends ee{constructor(t){super(),this.reviver=t}add(t){let e;if("string"===typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const s=e.type===is.BINARY_EVENT;s||e.type===is.BINARY_ACK?(e.type=s?is.EVENT:is.ACK,this.reconstructor=new os(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!We(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(void 0===is[s.type])throw new Error("unknown packet type "+s.type);if(s.type===is.BINARY_EVENT||s.type===is.BINARY_ACK){const i=e+1;while("-"!==t.charAt(++e)&&e!=t.length);const n=t.substring(i,e);if(n!=Number(n)||"-"!==t.charAt(e))throw new Error("Illegal attachments");s.attachments=Number(n)}if("/"===t.charAt(e+1)){const i=e+1;while(++e){const s=t.charAt(e);if(","===s)break;if(e===t.length)break}s.nsp=t.substring(i,e)}else s.nsp="/";const i=t.charAt(e+1);if(""!==i&&Number(i)==i){const i=e+1;while(++e){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(i,e+1))}if(t.charAt(++e)){const i=this.tryParse(t.substr(e));if(!rs.isPayloadValid(s.type,i))throw new Error("invalid payload");s.data=i}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case is.CONNECT:return"object"===typeof e;case is.DISCONNECT:return void 0===e;case is.CONNECT_ERROR:return"string"===typeof e||"object"===typeof e;case is.EVENT:case is.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case is.ACK:case is.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class os{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=ts(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function as(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const cs=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class hs extends ee{constructor(t,e,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[as(t,"open",this.onopen.bind(this)),as(t,"packet",this.onpacket.bind(this)),as(t,"error",this.onerror.bind(this)),as(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io["_reconnecting"]||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(cs.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const s={type:is.EVENT,data:e,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"===typeof e[e.length-1]){const t=this.ids++,i=e.pop();this._registerAckCallback(t,i),s.id=t}const i=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,n=this.flags.volatile&&(!i||!this.connected);return n||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(t,e){var s;const i=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===i)return void(this.acks[t]=e);const n=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),i);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(n),e.apply(this,[null,...t])}}emitWithAck(t,...e){const s=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise(((i,n)=>{e.push(((t,e)=>s?t?n(t):i(e):i(t))),this.emit(t,...e)}))}_addToQueue(t){let e;"function"===typeof t[t.length-1]&&(e=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push(((t,...i)=>{if(s!==this._queue[0])return;const n=null!==t;return n?s.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...i)),s.pending=!1,this._drainQueue()})),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this._sendConnectPacket(t)})):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:is.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){const e=t.nsp===this.nsp;if(e)switch(t.type){case is.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case is.EVENT:case is.BINARY_EVENT:this.onevent(t);break;case is.ACK:case is.BINARY_ACK:this.onack(t);break;case is.DISCONNECT:this.ondisconnect();break;case is.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e);break}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&"string"===typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let s=!1;return function(...i){s||(s=!0,e.packet({type:is.ACK,id:t,data:i}))}}onack(t){const e=this.acks[t.id];"function"===typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io["_destroy"](this)}disconnect(){return this.connected&&this.packet({type:is.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++)if(t===e[s])return e.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e)s.apply(this,t.data)}}}function us(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}us.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-s:t+s}return 0|Math.min(t,this.max)},us.prototype.reset=function(){this.attempts=0},us.prototype.setMin=function(t){this.ms=t},us.prototype.setMax=function(t){this.max=t},us.prototype.setJitter=function(t){this.jitter=t};class ls extends ee{constructor(t,e){var s;super(),this.nsps={},this.subs=[],t&&"object"===typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,ae(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=e.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new us({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const n=e.parser||i;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Ge(this.uri,this.opts);const e=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=as(e,"open",(function(){s.onopen(),t&&t()})),n=as(e,"error",(e=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",e),t?t(e):s.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&i();const s=this.setTimeoutFn((()=>{i(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(i),this.subs.push(n),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(as(t,"ping",this.onping.bind(this)),as(t,"data",this.ondata.bind(this)),as(t,"error",this.onerror.bind(this)),as(t,"close",this.onclose.bind(this)),as(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){Re((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new hs(this,t,e),this.nsps[t]=s),s}_destroy(t){const e=Object.keys(this.nsps);for(const s of e){const t=this.nsps[s];if(t.active)return}this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++)this.engine.write(e[s],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const ds={};function ps(t,e){"object"===typeof t&&(e=t,t=void 0),e=e||{};const s=Fe(t,e.path||"/socket.io"),i=s.source,n=s.id,r=s.path,o=ds[n]&&r in ds[n]["nsps"],a=e.forceNew||e["force new connection"]||!1===e.multiplex||o;let c;return a?c=new ls(i,e):(ds[n]||(ds[n]=new ls(i,e)),c=ds[n]),s.query&&!e.query&&(e.query=s.queryKey),c.socket(s.path,e)}Object.assign(ps,{Manager:ls,Socket:hs,io:ps,connect:ps});var fs={name:"meetingVue",props:{msg:String},data(){return{publishStream:null,videoControlImgSrc:"",userInfoList:{},uid:null,streams:{},roomId:null,socket:null,resolution:"qvga",videoMute:null,audioMute:null,signalLocal:null,clientLocal:null,localUsername:null,localStream:null,shareStream:null,isPublishStream:!1,isShareStream:!1,muteState:[],remoteStreamMute:null,messageText:"",messages:[],chatGPTMessages:[{sender:"bot",text:"您好，我是 ChatGPT。请问有什么可以帮您的？"}],chatGPTMessageText:"",finalTranscript:"",isRecognizing:!1,recognition:null,api:null,loadingMessageIndex:null,interimTranscript:""}},methods:{initSocket(){this.socket=ps(),this.socket.on("connect",(()=>{this.uid=this.socket.id,this.userInfoList[this.uid]={name:this.localUsername+"(self)",streamId:null,shareId:null},this.publishStream&&this.getLocalStream()})),this.socket.on("user-disconnected",(t=>{delete this.userInfoList[t]})),this.socket.on("join",((t,e)=>{let{name:s,videoMute:i,audioMute:n}=JSON.parse(e);this.userInfoList[t]={name:s,streamId:null,shareId:null,videoMute:i,audioMute:n},this.updateInfo()})),this.socket.on("updateInfo",((t,e)=>{let{name:s,streamId:i,shareId:n,videoMute:r,audioMute:o}=JSON.parse(e);this.userInfoList[t]={name:s,streamId:i,shareId:n,videoMute:r,audioMute:o}})),this.socket.on("message",(t=>{let e=JSON.parse(t);e.isSelf=!1,this.messages.push(e)})),this.socket.on("chatGPT",(t=>{this.chatGPTMessages.splice(this.loadingMessageIndex,1),this.chatGPTMessages.push({sender:"bot",text:t}),this.$refs.chatGPTInfo.scrollTo(0,this.$refs.chatGPTInfo.scrollHeight),this.$nextTick((()=>{this.$refs.chatGPTInfo.scrollTo(0,this.$refs.chatGPTInfo.scrollHeight)}))}))},async init(){this.roomId=this.$route.params.roomId,this.localUsername=sessionStorage.getItem("username"),this.resolution=sessionStorage.getItem("resolution"),this.videoMute="true"===sessionStorage.getItem("videoMute"),this.audioMute="true"===sessionStorage.getItem("audioMute"),this.remoteStreamMute="true"===sessionStorage.getItem("remoteStreamMute"),this.publishStream="true"===sessionStorage.getItem("publishStream");let t="ws://localhost:7000/ws",e={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun3.l.google.com:19302","stun:stun4.l.google.com:19302"]}]};this.signalLocal=new Pt.Q(t),this.clientLocal=new Ot.KU(this.signalLocal,e),await new Promise((t=>{this.signalLocal.onopen=()=>{this.clientLocal.join(this.roomId),this.initSocket(),this.socket.emit("join",this.roomId,JSON.stringify({name:this.localUsername,videoMute:this.videoMute,audioMute:this.audioMute})),t()}})),this.clientLocal.ontrack=(t,e)=>{console.log("got track",t.id,"for stream",e.id),t.onunmute=()=>{this.streams[e.id]||(this.muteState[e.id]=this.remoteStreamMute,this.streams[e.id]=e,e.onremovetrack=()=>{try{this.streams[e.id]&&delete this.streams[e.id]}catch(vs){console.log(vs)}})}}},async getLocalStream(){await Ot.WH.getUserMedia({resolution:this.resolution,audio:!0,codec:"vp8"}).then((t=>{console.log(this.resolution),this.localStream=t,this.changeLocalAudio(),this.changeLocalAudio(),this.clientLocal.publish(t),setTimeout((()=>{this.isPublishStream=!0}),100),this.muteState[t.id]=!0,this.streams[t.id]=t,this.changeLocalAudio(),this.changeLocalVideo(),this.updateInfo(),t.oninactive=()=>{this.streams[t.id]&&delete this.streams[t.id],t.unpublish();let e=t.getTracks();e.forEach((t=>{t.stop()})),this.localStream=null,this.shareStream=null,this.updateInfo()}})).catch((t=>{this.isPublishStream=!1,console.error(t)}))},controlSimulcast(t,e){t.preferLayer(e)},updateInfo(){let t,e;t=null===this.localStream?null:this.localStream.id,e=null===this.shareStream?null:this.shareStream.id,this.userInfoList[this.uid]={name:this.localUsername+"(self)",streamId:t,shareId:e,videoMute:this.videoMute,audioMute:this.audioMute},this.socket.emit("updateInfo",JSON.stringify({name:this.localUsername,streamId:t,shareId:e,videoMute:this.videoMute,audioMute:this.audioMute}))},changeLocalVideo(){let t=this.localStream.getVideoTracks();0!==t.length&&(this.videoMute?t[0].enabled=!1:t[0].enabled=!0),this.updateInfo()},changeLocalAudio(){let t=this.localStream.getAudioTracks();0!==t.length&&(this.audioMute?t[0].enabled=!1:t[0].enabled=!0),this.updateInfo()},controlLocalVideo(){this.videoMute=!this.videoMute,this.changeLocalVideo()},controlLocalAudio(){this.audioMute=!this.audioMute,this.changeLocalAudio()},controlLocalStream(){if(null!=this.localStream){if(null!=this.shareStream){this.shareStream.unpublish(),this.isShareStream=!1;let t=this.shareStream.getTracks();t.forEach((t=>{t.stop()})),this.shareStream=null}this.localStream.unpublish();let t=this.localStream.getTracks();t.forEach((t=>{t.stop()})),this.isPublishStream=!1,this.localStream=null,this.updateInfo(),this.callIcon=s(1642)}else this.getLocalStream(),this.callIcon=s(2053)},controlShareStream(){if(this.isShareStream){this.streams[this.shareStream.id]&&delete this.streams[this.shareStream.id],this.shareStream.unpublish(),this.isShareStream=!1;let t=this.shareStream.getTracks();t.forEach((t=>{t.stop()})),this.shareStream=null,this.updateInfo()}else Ot.WH.getDisplayMedia({resolution:"qvga",video:!0,audio:!0}).then((t=>{this.clientLocal.publish(t),this.isShareStream=!0,this.muteState[t.id]=!0,this.streams[t.id]=t,this.shareStream=t,this.updateInfo(),t.oninactive=()=>{this.streams[t.id]&&delete this.streams[t.id],t.unpublish(),this.isShareStream=!1;let e=t.getTracks();e.forEach((t=>{t.stop()})),this.shareStream=null,this.updateInfo(),this.shareBtnBackColor="white"}})).catch((t=>{console.error(`Failed to start screen sharing: ${t}`)}))},controlMessageBox(){this.$refs.messageBox.classList.contains("active")?(this.$refs.messageBox.classList.toggle("active",!1),this.$refs.body.classList.toggle("active",!1),this.$refs.messageInfo.scrollTo(0,this.$refs.messageInfo.scrollHeight)):(this.$refs.body.classList.toggle("active",!0),this.$refs.messageBox.classList.toggle("active",!0),this.$refs.chatGPTBox.classList.toggle("active",!1),this.$refs.userInfoListBox.classList.toggle("active",!1),this.$refs.messageInfo.scrollTo(0,this.$refs.messageInfo.scrollHeight))},sendMessage(){if(null!==this.messageText){const t={socketId:this.uid,text:this.messageText,isSelf:!0};this.socket.emit("message",JSON.stringify(t)),this.messages.push(t),this.messageText="",this.$refs.messageInfo.scrollTo(0,this.$refs.messageInfo.scrollHeight),this.$nextTick((()=>{this.$refs.messageInfo.scrollTo(0,this.$refs.messageInfo.scrollHeight)}))}},controlChatGPTBox(){this.$refs.chatGPTBox.classList.contains("active")?(this.$refs.chatGPTBox.classList.toggle("active",!1),this.$refs.body.classList.toggle("active",!1)):(this.$refs.body.classList.toggle("active",!0),this.$refs.chatGPTBox.classList.toggle("active",!0),this.$refs.messageBox.classList.toggle("active",!1),this.$refs.userInfoListBox.classList.toggle("active",!1),this.$refs.chatGPTBox.scrollTo(0,this.$refs.chatGPTBox.scrollHeight))},controlUserInfoBox(){this.$refs.userInfoListBox.classList.contains("active")?(this.$refs.userInfoListBox.classList.toggle("active",!1),this.$refs.body.classList.toggle("active",!1)):(this.$refs.body.classList.toggle("active",!0),this.$refs.userInfoListBox.classList.toggle("active",!0),this.$refs.messageBox.classList.toggle("active",!1),this.$refs.chatGPTBox.classList.toggle("active",!1))},controlRemoteAudio(t){!0===this.muteState[t]?this.muteState[t]=!1:!1===this.muteState[t]&&(this.muteState[t]=!0)},disconnect(){if(null!=this.localStream){this.localStream.unpublish();let t=this.localStream.getTracks();t.forEach((t=>{t.stop()}))}if(null!=this.shareStream){this.shareStream.unpublish();let t=this.shareStream.getTracks();t.forEach((t=>{t.stop()}))}},async sendChatGPTMessage(){if(await this.stopSpeechRecognition(),this.isRecognizing=!1,""!==this.chatGPTMessageText){this.chatGPTMessages.push({sender:"user",text:this.chatGPTMessageText}),this.chatGPTMessageText="",this.finalTranscript="",setTimeout((()=>{this.chatGPTMessageText="",this.finalTranscript=""}),500);const t=this.chatGPTMessages[this.chatGPTMessages.length-1].text;this.chatGPTMessages.push({sender:"bot",text:"正在回答问题，请稍等..."}),this.loadingMessageIndex=this.chatGPTMessages.length-1,this.socket.emit("chatGPT",t),this.$refs.chatGPTInfo.scrollTo(0,this.$refs.chatGPTInfo.scrollHeight),this.$nextTick((()=>{this.$refs.chatGPTInfo.scrollTo(0,this.$refs.chatGPTInfo.scrollHeight)}))}},startSpeechRecognition(){this.recognition=new window.webkitSpeechRecognition,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="zh-CN",this.recognition.onresult=t=>{this.interimTranscript="";for(let e=t.resultIndex;e<t.results.length;e++){const s=t.results[e][0].transcript;t.results[e].isFinal?this.finalTranscript+=s:this.interimTranscript+=s}this.chatGPTMessageText=this.finalTranscript+this.interimTranscript},this.recognition.onend=()=>{this.isRecognizing=!1,this.finalTranscript=""},this.recognition.start(),this.isRecognizing=!0},stopSpeechRecognition(){this.isRecognizing&&(this.recognition.stop(),this.isRecognizing=!1)},speakChatGPTMessage(t){let e=new SpeechSynthesisUtterance(t);window.speechSynthesis.speak(e)},onResolutionChange(){this.getLocalStream()}},async mounted(){await this.init()},beforeUnmount(){this.disconnect()},computed:{filteredUserInfoList(){return Object.values(this.userInfoList).filter((t=>null!==t.streamId))}},created(){window.MyData=this}},gs=s(89);const ms=(0,gs.Z)(fs,[["render",Rt],["__scopeId","data-v-8ad2f086"]]);var ys=ms},6951:function(t,e,s){"use strict";t.exports=s.p+"img/help-circle.0112bcde.svg"},7069:function(t,e,s){"use strict";t.exports=s.p+"img/message-square.747f324b.svg"},927:function(t,e,s){"use strict";t.exports=s.p+"img/mic-green.93d097ec.svg"},503:function(t,e,s){"use strict";t.exports=s.p+"img/mic-off-red.25878cb2.svg"},162:function(t,e,s){"use strict";t.exports=s.p+"img/mic-off.d19f90ec.svg"},9289:function(t,e,s){"use strict";t.exports=s.p+"img/mic.6d1a8104.svg"},6058:function(t,e,s){"use strict";t.exports=s.p+"img/monitor.166dd831.svg"},1642:function(t,e,s){"use strict";t.exports=s.p+"img/phone-call.c4b21022.svg"},2053:function(t,e,s){"use strict";t.exports=s.p+"img/phone-off.37efebc7.svg"},5427:function(t,e,s){"use strict";t.exports=s.p+"img/send.5a21e539.svg"},9389:function(t,e,s){"use strict";t.exports=s.p+"img/users.1a30af9a.svg"},880:function(t,e,s){"use strict";t.exports=s.p+"img/video-green.343b1027.svg"},1291:function(t,e,s){"use strict";t.exports=s.p+"img/video-off-red.657523d9.svg"},6939:function(t,e,s){"use strict";t.exports=s.p+"img/video-off.3d5e758d.svg"},6779:function(t,e,s){"use strict";t.exports=s.p+"img/video.740cf530.svg"},1206:function(t,e,s){"use strict";t.exports=s.p+"img/volume-2-green.1d8b8be3.svg"},8502:function(t,e,s){"use strict";t.exports=s.p+"img/volume-2.e341b09f.svg"},5053:function(t,e,s){"use strict";t.exports=s.p+"img/volume-x.0ad540b5.svg"}}]);
//# sourceMappingURL=582.d2f7fdbe.js.map